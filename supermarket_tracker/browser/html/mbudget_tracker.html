<!DOCTYPE html>

<html>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>
<script  src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js" integrity="sha512-UXumZrZNiOwnTcZSHLOfcTs0aos2MzBWHXOHOuB0J/R44QB0dwY5JgfbvljXcklVf65Gc4El6RjZ+lnwd2az2g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.0.1/chartjs-plugin-zoom.min.js" integrity="sha512-wUYbRPLV5zs6IqvWd88HIqZU/b8TBx+I8LEioQ/UC0t5EMCLApqhIAnUg7EsAzdbhhdgW07TqYDdH3QEXRcPOQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<head>
    <title>MBudget tracker</title>
    <style type="text/css">
        .chart-container {
            width: 640px;
            height: auto;
        }

        .chartBox {
            width: 750px;
        }

        .input_field_class {
            width: 200px;
        }

        .readonly_field_class {
            width: 200px;
            background-color: #a9a9a93c;
            border: none;
        }

        .slidecontainer {
            width: 200px;
            /* Width of the outside container */
        }
        .dropdown_white {background:white;}
        .dropdown_gray {background:gray;}

    </style>

</head>

<body>
    <h1>MBudget tracker</h1>
    <table>
        <tr>
            <td> Product </td>
            <td>
                <form action="">
                    <select id="product1-dropdown" name="Product1" onchange="loadProductData()" checked=true>
                    </select>
                </form>
            </td>
        </tr>
        <tr>
            <td> Product URL </td>
            <td>
                <a href="https://www.w3schools.com/" id="product1_url">Visit W3Schools.com!</a>
            </td>
        </tr>
    </table>
    <br>
    <div class="chartBox">
        <canvas id="chartCompare"></canvas>
    </div>
    <script>
        var max_graphs = 1;
        var productDict = new Object();
        var baseURL = "";
        if (location.hostname === "www.finspresso.com") {
            baseURL = "https://www.finspresso.com";
        }
        baseURL = baseURL + "/supermarket_tracker/php_files";
        var loadProducts = function () {
            $.ajax({
                url: baseURL + "/get_mbudget_products.php",
                method: "GET",
                success: function (data) {
                    //console.log(data);
                    let product_list = [];
                    for (var i in data) {
                        productDict[data[i]["Product Name"]] = data[i];
                        product_list.push(data[i]["Product Name"]);

                    }
                    product_list = product_list.sort();
                    for (var j = 1; j <= max_graphs; j++) {
                        let dropdown = document.getElementById("product" + j +"-dropdown");
                        for (product of product_list) {
                            let option = document.createElement("option");
                            option.text = product;
                            option.value = product;
                            if (productDict[product]["Category"] === "other") {
                                option.className = "dropdown_gray";
                            } else {
                                option.className = "dropdown_white";
                            }
                            dropdown.add(option);
                        }
                        dropdown.selectedIndex = 0;
                    }
                    loadProductData();
                },
                error: function (data) {
                    console.log(data);
                },
            });
        };

        var loadProductData = function () {
            updateProductURL();
        };
        var updateProductURL = function () {
            let dropdownProduct = document.getElementById("product1-dropdown");
            const productCurrent = dropdownProduct.options[dropdownProduct.selectedIndex].value;
            let product_url_element = document.getElementById("product1_url");
            product_url_element.href = productDict[productCurrent]["Product Link"];
            product_url_element.text = productDict[productCurrent]["Product Link"];
        };

        loadProducts();
    </script>
</body>

</html>
